<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ðŸŽ„ X-mas-Tree RACE Scoreboard ðŸŽ„</title>
<style>
    body {
        background-color: red;
        font-family: 'Comic Sans MS', cursive, sans-serif;
        text-align: center;
        padding-top: 50px;
        color: yellow;
    }
    .scorebox {
        background: #8b0000;
        border: 5px solid yellow;
        padding: 40px;
        font-size: 2rem;
        color: green;
        box-shadow: 0 0 30px yellow;
        animation: glow 3s alternate infinite;
        margin: 20px auto;
        width: 300px;
    }
    @keyframes glow {
        from { box-shadow: 0 0 10px #ff0; }
        to   { box-shadow: 0 0 40px #ff0; }
    }
</style>
</head>
<body>

<h1>ðŸŽ„ Kerst Scoreboard ðŸŽ„</h1>
<div id="scoreContainer"></div>

<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

const SUPABASE_URL = "https://itmhwyamdcdcompixnrk.supabase.co"
const SUPABASE_ANON_KEY = "sb_publishable_lun6Mhjl_0P4vqQNaPGyKw_OKNwJ9cW"

const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY)
const scoreContainer = document.getElementById("scoreContainer")

// functie om scores te laden
async function loadScores() {
    const { data, error } = await supabase
        .from("scoreboard")
        .select("*")
        .order("id", { ascending: false })
        .limit(10) // laat de 10 nieuwste scores zien

    if (error) {
        scoreContainer.innerHTML = "âš ï¸ FOUT"
        console.error(error)
        return
    }

    // clear container
    scoreContainer.innerHTML = ""

    // loop door alle scores en maak een div voor elke score
    data.forEach(entry => {
        const div = document.createElement("div")
        div.className = "scorebox"
        div.innerText = `${entry.player || "Player"}: ${entry.score}`
        scoreContainer.appendChild(div)
    })
}

// realtime updates
supabase
  .channel('realtime-score')
  .on('postgres_changes', { event: '*', schema: 'public', table: 'scoreboard' }, payload => {
      console.log("Realtime update:", payload)
      loadScores() // herlaad lijst bij elke update
  })
  .subscribe()

// eerste keer laden
loadScores()
</script>

</body>
</html>
